---
title: "Changes in IUCN Red List status from 2010 to present"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

Use the status history data for each species to tell whether its status has improved or worsened.

## Load libraries

```{r load libraries}
library(tidyverse)
```

# Load and reorganize status history data 

Before proceeding: 

* Species which don't appear in the Red List return `NA`, those are dropped 
* We are only interested in changes between "threatened" and non-"threatened" status, but the IUCN Red List web API returns several more categories. Those categories are appropriately collapsed and ordered before proceeding.
* Threat level ordering is according to [IUCN's criteria](https://www.iucnredlist.org/about/faqs#What%20are%20the%20Red%20List%20Categories%20and%20Criteria). But I am unsure whether I am handling `"threatened"` category correctly.

```{r load data}
assessmentHistories <- read.csv("results/redlistRead_complete.csv") %>% 
  drop_na(year) %>% 
  mutate(code = factor(code, ordered = TRUE),
         category = factor(category, ordered = TRUE)) %>% 
  mutate(
    cat_reassigned = fct_collapse(
      category,
      criticallyEndangered = "Critically Endangered",
      endangered = "Endangered",
      threatened = "Threatened",
      nearThreatened = "Near Threatened",
      vulnerable = "Vulnerable",
      leastConcern = "Least Concern",
      other = c("Rare", "Not Recognized", "Lower Risk/near threatened", "Lower Risk/least concern",
                "Lower Risk/conservation dependent", "Insufficiently Known", "Indeterminate",
                "Data Deficient", "\"Very rare but believed to be stable or increasing\"",
                "\"Very rare and believed to be decreasing in numbers\"",
                "\"Less rare but believed to be threatened-requires watching\"")
    ) %>% fct_relevel("criticallyEndangered", "endangered", "threatened",
                      "vulnerable", "nearThreatened", "leastConcern", "other")
  )
```
## Find change in status from 2010 to present

Assessments happen for different species at different times, so there is no fixed schedule of Red List updation. Hence, for our purposes, we choose the year 2010 status as the one prior, and closest, in time to it. We choose the most recent status as the present status.

### Status in 2010

```{r status 2010}
pre2010Status <- assessmentHistories %>% 
  filter(year <= 2010) %>% 
  group_by(sciName) %>% 
  summarise(
    status2010 = .data$cat_reassigned[.data$year == max(year)],
    status2010AssessmentYear = max(year)
  )
```

### Status now

```{r status present}
withPreAndPost2010Status <- left_join(pre2010Status, assessmentHistories, by = "sciName") %>% 
  filter(year > 2010) %>% 
  group_by(sciName) %>% 
  summarise(
    status2010 = status2010,
    status2010AssessmentYear = status2010AssessmentYear,
    statusNow = .data$cat_reassigned[.data$year == max(year)],
    statusNowAssessmentYear = max(year)
  )
```

### Find changes in status

```{r}
withPreAndPost2010Status <- withPreAndPost2010Status %>% 
  mutate(
    statusWorsened = statusNow < status2010,
    statusImproved = statusNow > status2010
  ) %>% 
  distinct(sciName, .keep_all = TRUE)
```

Species whose status improved:
```{r}
withPreAndPost2010Status %>%
  filter(statusImproved == TRUE) %>% 
  select(-statusWorsened)
```

Species whose status worsened:
```{r}
withPreAndPost2010Status %>%
  filter(statusWorsened == TRUE) %>% 
  select(-statusImproved)
```

## Session info

```{r}
sessionInfo()
```
